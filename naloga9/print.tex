\documentclass[a4paper,pdftex,11pt]{article}
\usepackage[margin=1cm,nohead]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc} 
\usepackage[english,slovene]{babel} 
\usepackage{amsmath,amsfonts,amsthm,amssymb,mathrsfs,empheq} % Math packages
\usepackage{mathtools}
\usepackage{dsfont}
\usepackage{wrapfig}
\usepackage[pdftex]{graphicx}
%\usepackage{makeidx}
\usepackage{url}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{float}

\usepackage[version=3]{mhchem} %kemija

\DeclarePairedDelimiter{\evdel}{\langle}{\rangle}   %pricakovana vrednost


\renewcommand{\vec}[1]{\boldsymbol{\mathbf{#1}}}                                        
\newcommand{\ihat}[0]{\boldsymbol{\mathbf{\oldhat{\textbf{\i}}}}} % pokončna j in i (j i n i
\newcommand{\iu}{{i\mkern1mu}}	    %imaginarno število
\DeclarePairedDelimiterX{\norm}[1]{\lVert}{\rVert}{#1} %norma

\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\fancyhead{} % No page header - if you want one, create it in the same way as the footers below
\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{13.6pt} % Customize the height of the header

%\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
%\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\setlength\parindent{0pt} % Removes all indentation from paragraphs - comment this line for an assignment with lots of text

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\newcommand{\horrule}[1]{\rule{\linewidth}{#1}} % Create horizontal rule command with 1 argument of height

\title{	
\normalfont \normalsize 
\textsc{Modelska analiza 1} \\ [25pt] % Your university, school and/or department name(s)
%\horrule{0.2pt} \\[0.4cm] % Thin top horizontal rule
\huge 11. naloga - Stohastični populacijski modeli\\ % The assignment title
%\horrule{0.2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{Tina Klobas} % Your name

\date{\normalsize\today} % Today's date or a custom date

\begin{document}

\maketitle % Print the title

\section{Opis problema}
V~nalogi se bomo ukvarjali s~Poissonovimi stohastičnimi procesi. S~tem se realni situaciji
približamo z~numeričnimimi približki tako, da na vsakem koraku integracije dopuščamo 
odmike od modela v~obliki napake. Na vsakem koraku tako izžrebamo naključno število, 
porazdeljeno okoli predvidene po Poissonovi porazdelitvi
\begin{equation}
    \frac{\lambda^x \mathrm{e}^{-\lambda}}{x \, !},
\end{equation}
kar bomo označevali z~$\mathcal{P}(\lambda)$.
%----------------------------------------------------------------------------------------
%	PROBLEM 1
%----------------------------------------------------------------------------------------
\section{Eksponentni model izumrtja}
Radi bi delali statistiko časov izumrtja za preprost eksponentni model ($\beta = 
1/\text{enota časa}$)
\begin{equation} \label{izumiranje}
    \frac{\mathrm{d} N }{N} = - \beta \mathrm{d}t \quad \rightarrow \quad
    N(t) = N_0 \mathrm{e}^{-\beta t}
\end{equation}
pri različnih začetnih velikostih populacije $N_0$. Zanima nas kako je ta čas povezan
z~velikostjo časovnega koraka $\Delta t$ in koliko se problem bliža modelu, ki vključuje
rojstva in smrti ($\beta_r =4\beta, \, \beta_s = 5\beta$).\\
Model~\ref{izumiranje} spravimo v~numerično obliko, tako da na vsakem koraku izračunamo
\begin{equation}
    N ( t+ \Delta t) = N(t) - \mathcal{P}(\beta N \Delta t).
\end{equation}

\subsubsection*{Velika začetna populacija: $N_0=250$}
Za fiksno začetno vrednost spreminjamo velikosti korakov $\Delta t = \{ 0.001, \, 0.01, \\
\, 0.1, \, 0.25, \, 0.5, \, 1 \}$.
Na grafu~\ref{slika1} je prikazanih $100$ ponovitev za korak $\Delta t = 0,01$ in njihovo 
povprečje (ki sovpada z~eksponentno funkcijo). Za različne korake podobno izračunamo
povprečja nekaj ponovitev, kar je prikazano na grafu~\ref{slika2}. Iz~obeh primerov vidimo, 
da je bolje jemati manjše korake, če se želimo približati realni vrednosti.
S~tem ko zmanjšamo korak, tudi zožimo Poissonovo funkcijo $\lambda = \beta N(t) \Delta t$
in s~tem zmanjšamo šum, oziroma nihanje okoli povprečne vrednosti.
\begin{figure}[H]
    \centering
    \resizebox{0.65\linewidth}{!}{\input{graf2.tex}}
    \caption{$100$ poskusov in njihova povprečna vrednost.}
    \label{slika1}
\end{figure}

\begin{figure}[H] 
    \centering 
    \resizebox{0.46\textwidth}{!}{\input{graf4.tex}} 
    \resizebox{0.46\textwidth}{!}{\input{graf5.tex}} 
    \caption{Povprečne vrednosti $100$ poskusov za različne $\Delta t$ za $N_0=250$.}
    \label{slika2}
\end{figure}

\subsubsection*{Majhna začetna populacija: $N_0=25$}

\begin{figure}[H]  
    \centering 
    \resizebox{0.46\textwidth}{!}{\input{graf6.tex}} 
    \resizebox{0.46\textwidth}{!}{\input{graf7.tex}} 
    \caption{Povprečne vrednosti $100$ poskusov za različne $\Delta t$ za $N_0=25$.}
    \label{slika3}
\end{figure}
Podobno kot v~prejšnjem primeru, tudi tukaj z~grafi~\ref{slika3} vidimo, da je bolje 
jemati krajše čase. 

\subsection{Časi izumrtja}
Zanimivo je opazovati čase izumrtja populacije. Na grafih~\ref{slika4} je prikazana
porazdelitev v~odvisnosti od različnih korakov $\Delta t$ za $N=10000$ poskusov. Na prvi 
pogled lahko že potrdimo prešnje grafe, da koraki, večji od $\Delta t = 0,1$, ne dajo 
dovolj natančnega rezultata in se precej razlikujejo od ostalih. Pri sliki za $N_0=250$ je 
odstopanje med različnimi koraki veliko manjše. Celoten graf za manjšo populacijo je 
pomaknjen v~levo, saj manjša populacija prej zamre. Pri tem grafu tudi opazimo, da razen
histogram za $\Delta t =1$, so vsi ostali veliko manj razlikujejo.

\begin{figure}    
    \centering 
    \resizebox{0.49\textwidth}{!}{\input{graf9.tex}} 
    \resizebox{0.49\textwidth}{!}{\input{graf8.tex}} 
    \caption{Histograma časov izumrtja za različno začetno vrednost populacije. Model
    je osnovni, samo s~parametrom, ki zmanjšuje populacijo.}
    \label{slika4}
\end{figure}

\subsubsection*{Rojstva in smrti}
Sedaj spremenimo model in upoštevamo rojstva in smrti (in dodatna parametra $\beta_r = 
4\beta$, $\beta_s = 5\beta$)
\begin{equation}
    \frac{\mathrm{d} N}{\mathrm{d} t} (t) = - \beta_s t + \beta_r t = -5\beta t + 4 \beta t
    = -\beta t
\end{equation}
enačba je enaka kot prej, le da sedaj dovolimo, da s~stohastičnim računanjem dovolimo
tudi občasno rast populacije, kar je tudi bolj podobno realnosti.
Stohastična enačba je tako:
\begin{equation}
    N (t + \Delta t) = N(t) - \mathcal{P}(\beta_s N \Delta t) + 
    \mathcal{P}(\beta_r N \Delta t).
\end{equation}
S~to razčlembo, ki dopušča tudi rojevanje smo tudi dobili večjo razpršenost stohastičnega 
modela, kar tudi vidimo na grafu~\ref{slika5}, ki je veliko bolj razsejan, kot ekvivalenten 
graf~\ref{slika1}.
\begin{figure}[H]
    \centering
    \resizebox{0.65\linewidth}{!}{\input{graf12.tex}}
    \caption{$100$ poskusov in njihova povprečna vrednost.}
    \label{slika5}
\end{figure}
Na grafih~\ref{slika6} je prikazana porazdelitev časov izumrtja za različne časovne korake 
in tudi tukaj ugotovimo, da se velikih korakov ne splača delati.

\begin{figure}    
    \centering 
    \resizebox{0.49\textwidth}{!}{\input{graf11.tex}} 
    \resizebox{0.49\textwidth}{!}{\input{graf10.tex}} 
    \caption{Histograma časov izumrtja za različno začetno vrednost populacije. Model
    dopušča ločena parametra rodnosti in smrtnosti.}
    \label{slika6}
\end{figure}
Na sliki~\ref{slika7} se bolje vidi primerjava med obema modeloma, kjer se tudi dobro
opazi, da je tudi čas izumrtja populacije nekoliko bolj razpršen kot prvi model. Poleg
tega pa populacija prej izgine, kar je posledica, da sistem bolj moten in vanj vnašamo več
šuma. Časi izumrtja s~tega grafa so \\
\\
\begin{tabularx}{\textwidth}{ |X|X|X| }
    \hline
    $\quad$ & $N_0 = 250$ & $N_0 = 25$ \\ 
    \hline 
    Združen model: & $t = 4,9$ & $t = 3,01$ \\ 
    \hline 
    Ločen model: & $t = 3,68$ & $t = 1,65$ \\ 
    \hline
\end{tabularx}

\begin{figure}    
    \centering 
    \resizebox{0.49\textwidth}{!}{\input{graf14.tex}} 
    \resizebox{0.49\textwidth}{!}{\input{graf13.tex}} 
    \caption{Primerjava histogramov za oba modela in pri obeh začetnih vrednostih $N_0$,
    pri koraku $\Delta t=0,01$.}
    \label{slika7}
\end{figure}
\pagebreak

%----------------------------------------------------------------------------------------
%	PROBLEM 2
%----------------------------------------------------------------------------------------
\section{Matrika prehodov}
Prejšnji problem lahko zapišemo tudi z~matriko prehodov. Za trenutno situacijo zapišemo 
vektor stanja: $\vec{x}(t) = (x_0,x_1,x_2,...,x_{N_0})$. Prehod na vsakem časovnem koraku 
zapišemo kot:
\begin{equation}
    \vec{x} (t+\Delta t) = M \vec{x} (t)
\end{equation}
oziroma
\begin{equation}
    \vec{x} (p \Delta t) = M^p \vec{x} (0),
\end{equation}
kjer je bilo začetno stanje modela $\vec{x}(0) = (0,0,0,\dots, 1)$ z~enico na $N_0$-tem
mestu. Vrednost komponente vektorja $x_i$ predstavlja verjetnost, da bo sistem v~$i$-tem 
stanju ob času $p \Delta t$. Komponente matrike $M$ so razvoji Poissonove funkcije za majhne
časovne korake in predstavljajo verjetnosti za dogodke v~sistemu (imamo 1 smrt, 
1 rojstvo, ...). Matrika ima tako tridiagonalno obliko
\begin{equation}
    M = 
    \begin{bmatrix}
	1 - (R_0 + S_0)\Delta t  & S_1\Delta t	& 0 \\
	R_0\Delta t  & 1 - (R_1 + S_1)\Delta t & S_2\Delta t & \dots \quad \\
	0 & R_1\Delta t  & 1 - (R_2 + S_2)\Delta t \\
	& \vdots & & \ddots
    \end{bmatrix}
\end{equation}
kjer so $R_n = \beta n$ verjetnosti za rojstva, $S_n = \beta n$ pa za smrti.
Za preprost model, kjer je smrtnost $\beta_s=1$ in rodnosti ni $\beta_r=0$ lahko 
na grafu~\ref{slika20} pogledamo kako se obnaša porazdelitvena funkcija -- začnemo z~delta
funkcijo ob času $t=0$ pri najvišji začetni velikosti populacije, ta se nato razvleče
in začne pomikati proti levi, dokler ne preidemo spet v~delta funkcijo.
\begin{figure}[H] 
    \centering 
    \resizebox{0.49\textwidth}{!}{\input{graf20a.tex}} 
    \resizebox{0.49\textwidth}{!}{\input{graf20b.tex}} 
    \caption{Verjetnosti, da je ob času $t$ velikost populacije $N$.}
    \label{slika20}
\end{figure}

Po $500$ poskusih povprečimo dobljene čase izumrtja in dobimo spodnji graf~\ref{slika21}.
Po pričakovanjih lahko vidimo, da ta je ta čas za večje korake veliko daljši.
\begin{figure}[H] 
    \centering 
    \resizebox{0.7\textwidth}{!}{\input{graf21.tex}} 
    \caption{Spreminjanje časa izumrtja $t_0$ pri različnih časovnih koraki $\Delta t$.}
    \label{slika21}
\end{figure}

\pagebreak
%----------------------------------------------------------------------------------------
%	PROBLEM 3
%----------------------------------------------------------------------------------------
\section{Model plen-plenilec}
Model življenja populacij lisic in zajcev smo že opazovali, sedaj pa parameter, ki je 
skrbel, da so se populacije manjšale/večale, tako kot pri prvi nalogi, razdelimo na smrtnost
in rodnost. Parametre rojstev zajcev označimo z~$\rho_z$ in lisic z~$\rho_l$, smrtnosti 
pa $\sigma_z$ in $\sigma_l$. Tako imamo sklopljeni enačbi
\begin{align}
    \dot{Z} &= \rho_z Z - \sigma_z Z - \gamma Z L \\
    \dot{L} &= \rho_l L - \sigma_l L + \delta Z L.
\end{align}
Na začetku imamo stanje z~$Z_0=200$ zajci in $L_0=50$ lisicami. Razmerje rodnost/smrtnost
za zajce je $\rho_z/\sigma_z = 5/4$ in za lisice $\rho_l/\sigma_l = 4/5$, oziroma
$\rho_z = 5\alpha, \, \sigma_z = 4\alpha$ in $\rho_l = 4\beta, \, \sigma_l = 5\beta$. 
Preostala parametra nastavimo tako, da sta $\gamma = \alpha /L_0$ in $\delta = \beta/Z_0$.
Tako dobimo stohastični enačbi za populaciji lisic in zajcev:
\begin{align}
    Z_{n+1} &= Z_{n} + \mathcal{P}(5 \alpha Z_n \Delta t) - \mathcal{P}(4 \alpha Z_n 
    \Delta t) - \mathcal{P}( \frac{\alpha}{L_0} Z_n L_n \Delta t) \\
    L_{n+1} &= L_{n} + \mathcal{P}(4 \beta L_n \Delta t) - \mathcal{P}(5 \beta L_n 
    \Delta t) + \mathcal{P}( \frac{\beta}{Z_0} Z_n L_n \Delta t)
\end{align}

\subsection{Reševanje}
Rešitve Lotka--Volterra problema so periodične eksponentne rasti/padanje za obe populaciji,
kar v~faznem prostoru predstavljajo elipsoidi -- nihanje populacij okoli ravnovesne lege. 
Tukaj si poglejmo kaj se zgodi, če začnemo v~ravnovesnem stanju -- $200$ zajcev in $50$
lisic, kjer spremembo populacije povežemo z~naključnim Poissonsko izžrebanim številom.
Ker imamo stohastičen model pričakujemo, da bosta populaciji ušli iz stacionarne točke,
kar opazimo na spodnjem grafu~\ref{slika18a}, kjer smo za časovni korak vzeli 
$\Delta t = 0.01$. Rešitev je spiralne oblike in se zaključi, v~tem primeru, z~izumrtjem
zajcev. 
\begin{figure}[H] 
    \centering
    \resizebox{0.49\linewidth}{!}{\input{graf18a.tex}}
    \resizebox{0.49\linewidth}{!}{\input{graf18b.tex}}
    \caption{Spreminjanje populacije zajcev in lisic pri časovnem koraku $\Delta t=0.01$. 
    Na desni je prikazan fazni diagram.}
    \label{slika18a}
\end{figure}
Zanimivo vprašanje, ki se tukaj pojavi je kdaj populacije zamrejo, oziroma kolikšna 
je povprečna življenska doba. Poleg tega lahko tudi preverimo katera izmed živalskih vrst
prej izumre. Za različne časovne korake naredimo $10000$ ponovitev in počakamo, da ena
izmed vrst izumre. Dobimo graf porazdelitve časov izumrtja~\ref{slika19}, kjer vidimo, da
z~manjšim časovnim korakom dobimo bolj razširjeno porazdelitev, vrh pa dobimo pri kasnejših
časih.
\begin{figure}[H] 
    \centering
    \resizebox{0.75\linewidth}{!}{\input{graf19.tex}}
    \caption{Spreminjanje populacije zajcev in lisic pri časovnem koraku $\Delta t=0.01$. 
    Na desni je prikazan fazni diagram.}
    \label{slika19}
\end{figure}
Dobljene življenske dobe $t_0$ s~tega histograma so:\\
\begin{center}
    \begin{tabularx}{0.45\textwidth}{ |c|X|X|X|X| }
	\hline
	$\Delta t$ & $0.5$ & $0.1$ & $0.01$ & $0.001$ \\ 
	\hline 
	$t_0$ & $4.7$ & $6.5$ & $7.0$ & $9.2$ \\ 
	\hline
    \end{tabularx}
\end{center}

\end{document}
